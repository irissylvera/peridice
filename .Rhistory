theme_bw() +
ggtitle("Statistical Variation of Metabolite Concentration (nM) in PERI-DICE")
View(quant_nmds)
unique(quant_nmds#metabolite)
)
unique(quant_nmds$metabolite))
unique(quant_nmds$metabolite)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment) %>%
mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment) %>%
mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
View(quant_nmds)
unique(quant_nmds$metaboltie)
unique(quant_nmds$metabolite)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id)
View(quant_mat)
unique(quant_mat$metabolite)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc")
View(quant_mat)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment) %>%
mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
View(quant_mat)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
mdsout <- quant_mat %>%
metaMDS(k = 2, autotransform = FALSE)
mds_data <- metadataframe %>%
ungroup() %>%
mutate(timepoint = str_replace_all(timepoint, "July", "-7-22")) %>%
mutate(timepoint = str_replace_all(timepoint, "June", "-6-22")) %>%
mutate(date = as.Date(timepoint, format = "%d-%m-%y")) %>%
filter(str_detect(filename, "Smp")) %>%
mutate(treatment = str_remove(treatment, "\\d")) %>%
mutate(id = paste(date, treatment)) %>%
select(-c("replicate", "filename"))
mdsout$points %>%
as.data.frame() %>%
rownames_to_column("id") %>%
left_join(mds_data) %>%
mutate(col_id=case_when(
treatment=="C"~"plum2",
treatment=="ZL"~"darkslategray2",
treatment=="ZH"~"lightseagreen",
treatment=="LL"~"gold",
treatment=="LH"~"lightcoral",
treatment=="RL"~"orange",
treatment=="RH"~"brown3",
treatment=="ZF"~"mediumpurple3",
TRUE~"grey50"
)) %>%
ggplot() +
geom_point(aes(x=MDS1, y=MDS2, color=col_id, shape = factor(date)), size=4) +
scale_color_identity(name = "treatment", guide = "legend",labels = c("Redfield Ratio - High N:P", "No N + Low P",
"Low N:P, Low Dose", "T0 - Before Treatments",
"Low N:P, High Dose", "No N + High P", "High P, No Fe",
"Redfield Ratio - Low N:P", "Control")) +
theme_bw() +
ggtitle("Statistical Variation of Metabolite Concentration (nM) in PERI-DICE")
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment) %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment) %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup()
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment) %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
View(quant_nmds)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment) %>%
na.omit() %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
View(quant_mat)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
na.omit()
View(quant_mat)
set.seed(20)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1)
View(quant_nmds)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol_in_enviro)) %>%
ungroup()
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
# complete(metabolite, date, treatment) %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
View(quant_nmds)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
mdsout <- quant_mat %>%
metaMDS(k = 2, autotransform = FALSE)
View(quant_mat)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
# complete(metabolite, date, treatment) %>%
mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol))
View(quant_mat)
unique(quant_mat$norm_conc)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
# complete(metabolite, date, treatment) %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id)
unique(quant_mat$norm_conc)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
complete(metabolite, date, treatment) %>%
mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
mdsout <- quant_mat %>%
metaMDS(k = 2, autotransform = FALSE)
mds_data <- metadataframe %>%
ungroup() %>%
mutate(timepoint = str_replace_all(timepoint, "July", "-7-22")) %>%
mutate(timepoint = str_replace_all(timepoint, "June", "-6-22")) %>%
mutate(date = as.Date(timepoint, format = "%d-%m-%y")) %>%
filter(str_detect(filename, "Smp")) %>%
mutate(treatment = str_remove(treatment, "\\d")) %>%
mutate(id = paste(date, treatment)) %>%
select(-c("replicate", "filename"))
mdsout$points %>%
as.data.frame() %>%
rownames_to_column("id") %>%
left_join(mds_data) %>%
mutate(col_id=case_when(
treatment=="C"~"plum2",
treatment=="ZL"~"darkslategray2",
treatment=="ZH"~"lightseagreen",
treatment=="LL"~"gold",
treatment=="LH"~"lightcoral",
treatment=="RL"~"orange",
treatment=="RH"~"brown3",
treatment=="ZF"~"mediumpurple3",
TRUE~"grey50"
)) %>%
ggplot() +
geom_point(aes(x=MDS1, y=MDS2, color=col_id, shape = factor(date)), size=4) +
scale_color_identity(name = "treatment", guide = "legend",labels = c("Redfield Ratio - High N:P", "No N + Low P",
"Low N:P, Low Dose", "T0 - Before Treatments",
"Low N:P, High Dose", "No N + High P", "High P, No Fe",
"Redfield Ratio - Low N:P", "Control")) +
theme_bw() +
ggtitle("Statistical Variation of Metabolite Concentration (nM) in PERI-DICE")
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id)
unique(quant_mat$date)
View(quant_mat)
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
# complete(metabolite, date, treatment) %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
View(quant_nmds)
unique(quant_nmds$avg_nmol)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
mutate(norm_conc = replace_na(norm_conc, 0)) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix() %>%
mutate_all(replace_na(0))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix() %>%
mutate_all(replace_na(quant_mat, 0))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
mutate_all(replace_na( 0))
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
replace_na(0) %>%
data.matrix()
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
replace(is.na(.), 0)
View(quant_mat)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
replace(is.na(.), 0) %>%
data.matrix()
mdsout <- quant_mat %>%
metaMDS(k = 2, autotransform = FALSE)
mds_data <- metadataframe %>%
ungroup() %>%
mutate(timepoint = str_replace_all(timepoint, "July", "-7-22")) %>%
mutate(timepoint = str_replace_all(timepoint, "June", "-6-22")) %>%
mutate(date = as.Date(timepoint, format = "%d-%m-%y")) %>%
filter(str_detect(filename, "Smp")) %>%
mutate(treatment = str_remove(treatment, "\\d")) %>%
mutate(id = paste(date, treatment)) %>%
select(-c("replicate", "filename"))
mdsout$points %>%
as.data.frame() %>%
rownames_to_column("id") %>%
left_join(mds_data) %>%
mutate(col_id=case_when(
treatment=="C"~"plum2",
treatment=="ZL"~"darkslategray2",
treatment=="ZH"~"lightseagreen",
treatment=="LL"~"gold",
treatment=="LH"~"lightcoral",
treatment=="RL"~"orange",
treatment=="RH"~"brown3",
treatment=="ZF"~"mediumpurple3",
TRUE~"grey50"
)) %>%
ggplot() +
geom_point(aes(x=MDS1, y=MDS2, color=col_id, shape = factor(date)), size=4) +
scale_color_identity(name = "treatment", guide = "legend",labels = c("Redfield Ratio - High N:P", "No N + Low P",
"Low N:P, Low Dose", "T0 - Before Treatments",
"Low N:P, High Dose", "No N + High P", "High P, No Fe",
"Redfield Ratio - Low N:P", "Control")) +
theme_bw() +
ggtitle("Statistical Variation of Metabolite Concentration (nM) in PERI-DICE")
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
# complete(metabolite, date, treatment) %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
View(quant_nmds)
quant_mat <- quant_nmds %>%
group_by(metabolite, id) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
View(quant_mat)
quant_mat <- quant_nmds %>%
group_by(metabolite) %>%
mutate(norm_conc = rank(avg_nmol)) %>%
select(metabolite, norm_conc, id) %>%
pivot_wider(names_from = "metabolite", values_from = "norm_conc") %>%
column_to_rownames("id") %>%
data.matrix()
data_vis %>%
group_by(metabolite, treatment, date) %>%
mutate(nmol_avg = mean(nmol)) %>%
distinct(nmol_avg, .keep_all = TRUE) %>%
filter(nmol >= 5) %>%
ggplot() +
geom_col(aes(x = date, y = nmol_avg, fill = metabolite), position = "fill") +
scale_fill_manual(values = mycolors) +
facet_wrap(~treatment) +
guides(fill=guide_legend(ncol=2)) +
theme_bw()
quant_data %>%
group_by(metabolite) %>%
mutate(mean_nm=mean(nmol)) %>%
arrange(desc(mean_nm)) %>%
ungroup() %>%
mutate(metabolite = fct_inorder(metabolite)) %>%
ggplot(aes(y = metabolite, x = log10(nmol))) +
geom_boxplot() +
theme_bw()
plotly::ggplotly
quant_data <- quant_data_pos %>%
full_join(quant_data_neg) %>%
filter(nmol_in_enviro > 0) %>%
mutate(treatment = str_extract(replicate, "Std|Poo|Blk|C|ZF|ZL|ZH|RL|RH|LL|LH|Tote")) %>%
mutate(timepoint = str_extract(replicate, "27June|30June|14July|21July|27July")) %>%
mutate(timepoint = str_replace_all(timepoint, "July", "-7-22")) %>%
mutate(timepoint = str_replace_all(timepoint, "June", "-6-22")) %>%
mutate(date = as.Date(timepoint, format = "%d-%m-%y")) %>%
select(metabolite, treatment, date, nmol = nmol_in_enviro, replicate)
View(quant_data)
data_vis <- quant_data
data_vis %>%
group_by(metabolite, treatment, date) %>%
mutate(nmol_avg = mean(nmol)) %>%
distinct(nmol_avg, .keep_all = TRUE) %>%
filter(nmol >= 15) %>%
ggplot() +
geom_col(aes(x = treatment, y = nmol_avg, fill = metabolite), position = "fill") +
scale_fill_manual(values = mycolors) +
facet_wrap(~date) +
guides(fill=guide_legend(ncol=2)) +
theme_bw()
quant_nmds <- data_vis %>%
arrange(desc(nmol)) %>%
group_by(metabolite, replicate) %>%
slice(1) %>%
group_by(metabolite, treatment, date) %>%
summarise(avg_nmol = mean(nmol)) %>%
ungroup() %>%
# complete(metabolite, date, treatment) %>%
# mutate(avg_nmol = replace_na(avg_nmol, 0)) %>%
mutate(id = paste(date, treatment))
View(quant_nmds)
unique(quant_nmds$id)
library(tidyverse)
library(readr)
library(ggplot2)
library(vegan)
library(tidyverse)
library(readr)
library(ggplot2)
library(vegan)

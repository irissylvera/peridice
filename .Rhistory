filter(str_detect(replicate, "Tote|30June|14July|27July")) %>%
ggplot() +
geom_col(aes(x = factor(date), y = nmol_per_pc, fill = metab_type), position = "stack") +
scale_fill_manual(values = mycolors) +
facet_wrap(~rate) +
theme_bw()
ggplotly(metab_type_plot)
metab_type_plot <- data_vis_qual %>%
mutate(rate = str_replace(rate, "F", "H")) %>%
filter(str_detect(replicate, "Tote|30June|14July|27July")) %>%
ggplot() +
geom_col(aes(x = factor(date), y = nmol_per_pc, fill = metab_type), position = "fill") +
scale_fill_manual(values = mycolors) +
facet_wrap(~rate) +
theme_bw()
ggplotly(metab_type_plot)
metab_type_plot <- data_vis_qual %>%
mutate(rate = str_replace(rate, "F", "H")) %>%
filter(str_detect(replicate, "Tote|30June|14July|27July")) %>%
ggplot() +
geom_col(aes(x = factor(date), y = nM, fill = metab_type), position = "fill") +
scale_fill_manual(values = mycolors) +
facet_wrap(~rate) +
theme_bw()
ggplotly(metab_type_plot)
metab_type_plot <- data_vis_qual %>%
mutate(rate = str_replace(rate, "F", "H")) %>%
filter(str_detect(replicate, "Tote|30June|14July|27July")) %>%
ggplot() +
geom_col(aes(x = factor(date), y = nM, fill = metab_type), position = "stack") +
scale_fill_manual(values = mycolors) +
facet_wrap(~rate) +
theme_bw()
ggplotly(metab_type_plot)
metab_type_plot <- data_vis_qual %>%
mutate(rate = str_replace(rate, "F", "H")) %>%
filter(str_detect(replicate, "Tote|30June|14July|27July")) %>%
ggplot() +
geom_col(aes(x = factor(date), y = nmol_per_pc, fill = metab_type), position = "stack") +
scale_fill_manual(values = mycolors) +
facet_wrap(~rate) +
theme_bw()
ggplotly(metab_type_plot)
metab_type_plot <- data_vis_qual %>%
mutate(rate = str_replace(rate, "F", "H")) %>%
filter(str_detect(replicate, "Tote|30June|14July|27July")) %>%
ggplot() +
geom_col(aes(x = factor(date), y = nM, fill = metab_type), position = "stack") +
scale_fill_manual(values = mycolors) +
facet_wrap(~rate) +
theme_bw()
ggplotly(metab_type_plot)
metab_type_plot <- data_vis_qual %>%
mutate(rate = str_replace(rate, "F", "H")) %>%
filter(str_detect(replicate, "Tote|30June|14July|27July")) %>%
ggplot() +
geom_col(aes(x = factor(date), y = nmol_per_pc, fill = metab_type), position = "stack") +
scale_fill_manual(values = mycolors) +
facet_wrap(~rate) +
theme_bw()
ggplotly(metab_type_plot)
sulfur <- data_vis_qual %>%
filter(metab_type == "Sulfur")
View(sulfur)
unique(sulfur$metabolite)
sulfur <- data_vis_qual %>%
filter(metab_type == "Sulfur") %>%
group_by(metabolite, treatment, date) %>%
filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_wrap(~factor(metabolite, levels = c("Glycerophosphocholine", "Phosphocholine")), ncol = 1, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
sulfur <- data_vis_qual %>%
filter(metab_type == "Sulfur")
sulfur %>%
group_by(metabolite, treatment, date) %>%
filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_wrap(~factor(metabolite, levels = c("Glycerophosphocholine", "Phosphocholine")), ncol = 1, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
sulfur %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_grid(~metabolite, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
sulfur %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_wrap(~metabolite, ncol = 2) +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
sulfur %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_wrap(~metabolite, ncol = 3) +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
sulfur %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nM, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_wrap(~metabolite, ncol = 3) +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
View(data_vis_qual)
unique(data_vis_qual$metab_type)
osmos <- data_vis_qual %>%
filter(metab_type == "Osmolyte")
osmos %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nM, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_wrap(~metabolite, ncol = 3) +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
osmos %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nM, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_wrap(~metabolite, ncol = 2) +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
osmos %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
scale_y_log10() +
facet_wrap(~metabolite, ncol = 2, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
osmos %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
# scale_y_log10() +
facet_wrap(~metabolite, ncol = 2, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
osmos %>%
group_by(metabolite, treatment, date) %>%
filter(str_detect(metabolite, "Trigonelline")) %>%
# filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
# scale_y_log10() +
facet_wrap(~metabolite, ncol = 2, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
osmos %>%
group_by(metabolite, treatment, date) %>%
filter(str_detect(metabolite, "Trigonelline")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
# scale_y_log10() +
facet_wrap(~metabolite, ncol = 2, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
osmos %>%
group_by(metabolite, treatment, date) %>%
filter(str_detect(metabolite, "Ectoine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
# scale_y_log10() +
facet_wrap(~metabolite, ncol = 2, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
osmos %>%
group_by(metabolite, treatment, date) %>%
filter(str_detect(metabolite, "Ectoine")) %>%
#filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
# scale_y_log10() +
facet_wrap(~metabolite, ncol = 2, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
osmos %>%
group_by(metabolite, treatment, date) %>%
filter(str_detect(metabolite, "Ectoine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nmol_per_pc, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
# scale_y_log10() +
facet_wrap(~metabolite, ncol = 2, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
sulfur %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nM, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
# scale_y_log10() +
facet_wrap(~metabolite, ncol = 3) +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
sulfur %>%
group_by(metabolite, treatment, date) %>%
# filter(str_detect(metabolite, "Glycerophosphocholine|Phosphocholine")) %>%
filter(!str_detect(treatment, "Tote")) %>%
ggplot(aes(x = date, y = nM, color = factor(treatment, levels = level_order), group = interaction(date, treatment))) +
geom_boxplot() +
scale_color_manual(values = c("plum2","mediumpurple3","darkslategray2", "lightseagreen","gold", "lightcoral","orange", "brown3"),
labels = c("Control","0N:1P:0Fe, high dose P","0N:1P, low dose added", "0N:1P, high dose added",
"6N:1P, low dose added", "6N:1P, high dose added",
"16N:1P, low dose added", "16N:1P, high dose added"),
name = "Treatment") +
guides(fill=guide_legend(ncol=2)) +
# scale_y_log10() +
facet_wrap(~metabolite, ncol = 3, scales = "free_y") +
theme_bw() +
xlab("Date") +
ylab("nM (nmol per L)")
data_vis_km <- data_vis_qual %>%
pivot_wider(names_from = metabolite, values_from = nM) %>%
select(-c("treatment", "date")) %>%
column_to_rownames("replicate") %>%
data.matrix() %>%
`[<-`(is.na(.), 0) %>%
scale() %>%
t() %>%
kmeans(centers = 6) %>%
pluck("cluster") %>%
as.data.frame() %>%
set_names("cluster") %>%
rownames_to_column("metabolite")
View(data_vis_qual)
metab_qual <- read_csv("csvs/peak_quality.csv") %>%
select(metabolite = Metabolite, quality = Quality)
# Chunk 1
library(tidyverse)
library(ggplot2)
library(RColorBrewer)
library(plotly)
library(vegan)
library(heatmaply)
library(ggnewscale)
library(readr)
library(readxl)
library(corrr)
library(ggcorrplot)
library(FactoMineR)
library(stats)
library(ggfortify)
library(ggh4x)
set.seed(20)
# Chunk 2
quant_data <- read_csv("csvs/quant_data.csv") %>%
filter(nM > 0) %>%
filter(nM < 100)
metadataframe <- read_csv("csvs/metadataframe.csv")
pcpn <- read_xlsx("metadata/peridice_pcpn.xlsx") %>%
select(tank = Tank, treatment = Treatment2, date = Date, pn = `PN (uM)`, pc = `PC (uM)`, cn = Cnratio,added_N_uM = AddN) %>%
mutate(triplicate = str_extract(tank, "\\d")) %>%
mutate(tank = str_remove (tank, "1/2|1/3|2/2"))  %>%
group_by(tank, date) %>%
mutate(mean_pc = mean(pc)) %>%
distinct(mean_pc, .keep_all = TRUE) %>%
mutate(replicate = paste0("230616_Smp_", ""))
data_vis <- quant_data %>%
mutate(treatment = str_extract(replicate, "Std|Poo|Blk|C|ZF|ZL|ZH|RL|RH|LL|LH|Tote1|Tote2|Tote3|Tote4")) %>%
mutate(timepoint = str_extract(replicate, "27June|30June|14July|21July|27July")) %>%
mutate(timepoint = str_replace_all(timepoint, "July", "-7-22")) %>%
mutate(timepoint = str_replace_all(timepoint, "June", "-6-22")) %>%
mutate(date = as.Date(timepoint, format = "%d-%m-%y")) %>%
select(metabolite, treatment, date, nM, replicate) %>%
filter(metabolite != "Sodium 2-mercaptoethanesulfonate") %>%
filter(metabolite != "Fumaric acid") %>%
na.omit() %>%
mutate(triplicate = str_extract(replicate, "\\d$"))
level_order <- c("T0", "C", "ZF", "ZL", "ZH", "LL", "LH", "RL", "RH")
heat_level_order_treat <- c("2022-06-27 Tote", "2022-06-30 C",  "2022-07-14 C",  "2022-07-21 C",  "2022-07-27 C",
"2022-06-30 ZF", "2022-07-14 ZF", "2022-07-21 ZF", "2022-07-27 ZF",
"2022-06-30 ZL", "2022-07-14 ZL", "2022-07-21 ZL", "2022-07-27 ZL",
"2022-06-30 ZH", "2022-07-14 ZH", "2022-07-21 ZH", "2022-07-27 ZH",
"2022-06-30 LL", "2022-07-14  LL", "2022-07-21 LL", "2022-07-27 LL",
"2022-06-30 LH", "2022-07-14 LH", "2022-07-21 LH", "2022-07-27 LH",
"2022-06-30 RL", "2022-07-14 RL", "2022-07-21 RL", "2022-07-27 RL",
"2022-06-30 RH", "2022-07-14 RH", "2022-07-21 RH", "2022-07-27 RH")
heat_level_order_date <- c("2022-06-27 Tote", "2022-06-30 C","2022-06-30 ZF", "2022-06-30 ZL",
"2022-06-30 ZH", "2022-06-30 LL","2022-06-30 LH", "2022-06-30 RL", "2022-06-30 RH",
"2022-07-14 C", "2022-07-14 ZF", "2022-07-14 ZL", "2022-07-14 ZH", "2022-07-14 LL",
"2022-07-14 LH", "2022-07-14 RL", "2022-07-14 RH",
"2022-07-21 C", "2022-07-21 ZF", "2022-07-21 ZL", "2022-07-21 ZH",
"2022-07-21 LL", "2022-07-21 LH", "2022-07-21 RL", "2022-07-21 RH",
"2022-07-27 C", "2022-07-27 ZF", "2022-07-27 ZL",
"2022-07-27 ZH", "2022-07-27 LL", "2022-07-27 LH", "2022-07-27 RL",  "2022-07-27 RH")
data_vis_norm <- data_vis %>%
group_by(replicate, date, metabolite) %>%
mutate(nM = mean(nM)) %>%
left_join(pcpn, by = c("treatment", "date", "triplicate")) %>%
mutate(nmol_per_pc = nM/pc) %>%
select(replicate = replicate.x, metabolite, treatment, date, nM, triplicate, nmol_per_pc) %>%
mutate(treatment = str_remove(treatment, "\\d"))
metab_groups <- read.csv(
"https://raw.githubusercontent.com/IngallsLabUW/Ingalls_Standards/master/Ingalls_Lab_Standards.csv",
stringsAsFactors = FALSE, header = TRUE) %>%
select(metabolite = Compound_Name, emp_form = Empirical_Formula, metab_type = Compound_Type)
library(tidyverse)
library(ggplot2)
library(RColorBrewer)
library(plotly)
library(vegan)
library(heatmaply)
library(ggnewscale)
library(readr)
library(readxl)
library(corrr)
library(ggcorrplot)
library(FactoMineR)
library(stats)
library(ggfortify)
library(ggh4x)
set.seed(20)
quant_data <- read_csv("csvs/quant_data.csv") %>%
filter(nM > 0) %>%
filter(nM < 100)
metadataframe <- read_csv("csvs/metadataframe.csv")
pcpn <- read_xlsx("metadata/peridice_pcpn.xlsx") %>%
select(tank = Tank, treatment = Treatment2, date = Date, pn = `PN (uM)`, pc = `PC (uM)`, cn = Cnratio,added_N_uM = AddN) %>%
mutate(triplicate = str_extract(tank, "\\d")) %>%
mutate(tank = str_remove (tank, "1/2|1/3|2/2"))  %>%
group_by(tank, date) %>%
mutate(mean_pc = mean(pc)) %>%
distinct(mean_pc, .keep_all = TRUE) %>%
mutate(replicate = paste0("230616_Smp_", ""))
data_vis <- quant_data %>%
mutate(treatment = str_extract(replicate, "Std|Poo|Blk|C|ZF|ZL|ZH|RL|RH|LL|LH|Tote1|Tote2|Tote3|Tote4")) %>%
mutate(timepoint = str_extract(replicate, "27June|30June|14July|21July|27July")) %>%
mutate(timepoint = str_replace_all(timepoint, "July", "-7-22")) %>%
mutate(timepoint = str_replace_all(timepoint, "June", "-6-22")) %>%
mutate(date = as.Date(timepoint, format = "%d-%m-%y")) %>%
select(metabolite, treatment, date, nM, replicate) %>%
filter(metabolite != "Sodium 2-mercaptoethanesulfonate") %>%
filter(metabolite != "Fumaric acid") %>%
na.omit() %>%
mutate(triplicate = str_extract(replicate, "\\d$"))
level_order <- c("T0", "C", "ZF", "ZL", "ZH", "LL", "LH", "RL", "RH")
heat_level_order_treat <- c("2022-06-27 Tote", "2022-06-30 C",  "2022-07-14 C",  "2022-07-21 C",  "2022-07-27 C",
"2022-06-30 ZF", "2022-07-14 ZF", "2022-07-21 ZF", "2022-07-27 ZF",
"2022-06-30 ZL", "2022-07-14 ZL", "2022-07-21 ZL", "2022-07-27 ZL",
"2022-06-30 ZH", "2022-07-14 ZH", "2022-07-21 ZH", "2022-07-27 ZH",
"2022-06-30 LL", "2022-07-14  LL", "2022-07-21 LL", "2022-07-27 LL",
"2022-06-30 LH", "2022-07-14 LH", "2022-07-21 LH", "2022-07-27 LH",
"2022-06-30 RL", "2022-07-14 RL", "2022-07-21 RL", "2022-07-27 RL",
"2022-06-30 RH", "2022-07-14 RH", "2022-07-21 RH", "2022-07-27 RH")
heat_level_order_date <- c("2022-06-27 Tote", "2022-06-30 C","2022-06-30 ZF", "2022-06-30 ZL",
"2022-06-30 ZH", "2022-06-30 LL","2022-06-30 LH", "2022-06-30 RL", "2022-06-30 RH",
"2022-07-14 C", "2022-07-14 ZF", "2022-07-14 ZL", "2022-07-14 ZH", "2022-07-14 LL",
"2022-07-14 LH", "2022-07-14 RL", "2022-07-14 RH",
"2022-07-21 C", "2022-07-21 ZF", "2022-07-21 ZL", "2022-07-21 ZH",
"2022-07-21 LL", "2022-07-21 LH", "2022-07-21 RL", "2022-07-21 RH",
"2022-07-27 C", "2022-07-27 ZF", "2022-07-27 ZL",
"2022-07-27 ZH", "2022-07-27 LL", "2022-07-27 LH", "2022-07-27 RL",  "2022-07-27 RH")
data_vis_norm <- data_vis %>%
group_by(replicate, date, metabolite) %>%
mutate(nM = mean(nM)) %>%
left_join(pcpn, by = c("treatment", "date", "triplicate")) %>%
mutate(nmol_per_pc = nM/pc) %>%
select(replicate = replicate.x, metabolite, treatment, date, nM, triplicate, nmol_per_pc) %>%
mutate(treatment = str_remove(treatment, "\\d"))
View(data_vis)
data_vis_norm <- data_vis %>%
group_by(replicate, date, metabolite)
